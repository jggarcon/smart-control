<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8"/>
  <title th:text="${title}">Smart Control</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 2rem; }
    .card { max-width: 720px; padding: 1.25rem; border: 1px solid #ddd; border-radius: 12px; }
    h1 { margin: 0 0 0.5rem 0; }
    ul { padding-left: 1.2rem; }
    li { margin-bottom: 0.5rem; }
    strong { color: #222; }
    span { color: #555; }
  </style>
</head>
<body>
<div class="card">
  <h1 th:text="${title}">Smart Control</h1>
  <p>Here are your devices:</p>

  <ul>
    <li th:each="device : ${devices}">

      <strong th:text="${device.name}"></strong> —
      <span th:text="${device.stateLabel()}"></span>

      <th:block th:if="${device.kind == 'Light'}">
        <form th:action="@{'/light/' + ${device.id} + '/toggle'}" method="post" style="display:inline">
          <button type="submit" th:text="${device.isOn()} ? 'Turn OFF' : 'Turn ON'">Toggle</button>
        </form>
      </th:block>

      <th:block th:if="${device.kind == 'Fan'}">
        <form th:action="@{'/fan/' + ${device.id} + '/speed'}" method="post" style="display:inline; margin-left:8px">
          <label th:for="'speed-' + ${device.id}" style="margin-right:6px;">Speed:</label>

          <label>
            <input
                    type="range"
                    name="speed"
                    th:id="'speed-' + ${device.id}"
                    min="0" max="2"
                    th:value="${device.speed}"
                    style="vertical-align:middle; width:120px;"
                    oninput="document.getElementById(this.dataset.target).textContent = this.value"
                    onchange="this.form.submit()"
                    th:attr="data-target=${'speedVal-' + device.id}"
            />
          </label>

          <span th:id="'speedVal-' + ${device.id}" style="margin-left:6px;" th:text="${device.speed}">0</span>
        </form>
      </th:block>


      <th:block th:if="${device.kind == 'AirConditioner'}">
        <form th:action="@{'/ac/' + ${device.id} + '/power'}" method="post" style="display:inline; margin-left:8px">
          <button type="submit" name="on" value="true"  th:disabled="${device.on}">On</button>
          <button type="submit" name="on" value="false" th:disabled="${!device.on}">Off</button>
        </form>

        <th:block th:if="${device.on}">
          <form th:action="@{'/ac/' + ${device.id} + '/temperature'}" method="post" style="display:inline; margin-left:8px">
            <label th:for="'temp-' + ${device.id}">Temp (°C):</label>
            <input
                    type="number"
                    name="temp"
                    min="16" max="30"
                    th:id="'temp-' + ${device.id}"
                    th:value="${device.temperatureC}"
                    onchange="this.form.submit()"
                    style="width:60px;"
            />
          </form>
        </th:block>
      </th:block>



    </li>
  </ul>
</div>
</body>
</html>
